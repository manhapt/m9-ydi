{% extends 'base.html.twig' %}

{% block body %}
    <script defer src="{{ absolute_url(asset('wp-includes/js/azure/dash.all.js')) }}" type="text/javascript"></script>
    <script>
        jQuery(document).ready(function ($) {
            jQuery(window).load(function () {
                setupVideo();
            });

            var dataTab = $('.lecture-container-header a');
            dataTab.on('click', function () {
                var tabID = $(this).attr('data-toggle');
                $('.lecture-container-header > li').removeClass('active');
                $('.tab-pane').removeClass('active');
                $(this).parent().addClass('active');
                if (tabID == 1) {
                    $('#lecture-tab-list').addClass('active');
                }
                if (tabID == 2) {
                    $('#lecture-tab-download').addClass('active');
                }
                if (tabID == 3) {
                    $('#lecture-tab-discussion').addClass('active');
                }
            });

        });
        // setup the video element and attach it to the Dash player
        function setupVideo() {
            var url = "{{ asset.uri }}{{ asset.name }}.ism/manifest(format=mpd-time-csf)";
            var context = new Dash.di.DashContext();
            var player = new MediaPlayer(context);
            player.startup();
            player.attachView(document.querySelector("#videoplayer"));
            player.attachSource(url);
        }
        // using embed to render document file type
        $('#lecture-tab-download .chap-item > a').on('click', function (e) {
            e.preventDefault();
            var dataSrc = $(this).attr('href');
            $('.lecture-document .file-preview').attr('src', dataSrc);
            $('.preview').hide();
            $('.lecture-document').show();
            $(this).find('.item-container.fa').addClass('current');
        })
    </script>
    <section class="course-show lecture-details">
        <div class="container">
            <div class="row">
                <section class="section-title section-setting">
                    <div class="title">
                        <i class="fa fa-book-open fa-2x fa-pull-left"></i>
                        <h1>{{ course.name }}</h1>
                        {% if(course.shortDescription) %}
                            <p class="sub-title">{{ course.shortDescription }}</p>
                        {% endif %}

                        {% set assetCounter = 0 %}
                        {% set learnedCounter = 0 %}
                        {% for courseOption in courseOptions %}
                            {% for assetLink in courseOption.assets %}
                                {% set assetCounter = assetCounter+1 %}
                            {% endfor %}
                        {% endfor %}
                        {% for learnedAsset in learnedAssets %}
                            {% set learnedCounter = learnedCounter+1 %}
                        {% endfor %}

                        <p class="sub-title process-text">{{ 'Complete'|trans }}: </p>
                        <div class="process meter">
                            {% set percent = (learnedCounter/assetCounter) * 100 %}
                            <span style="width: {{ percent }}%"></span>
                        </div>
                    </div>
                </section>
                <!-- course item -->
                <div class="content">
                    <div class="preview col-xs-12 col-sm-7 col-md-8 lecture-player no-padding">
                        <video id="videoplayer" controls></video>
                    </div>
                    <div class="preview col-xs-12 col-sm-7 col-md-8 lecture-image no-padding lecture-image">
                        {% if asset.image %}
                            <figure>
                                <img src="{{ asset('wp-content/uploads/courses/assets/' ~ asset.image) }}"/>
                            </figure>
                        {% endif %}
                    </div>
                    <div class="preview col-xs-12 col-sm-7 col-md-8 lecture-document no-padding">
                            <embed class="file-preview" src="" width="100%" height="450" alt="Document"
                               pluginspage="http://www.adobe.com/products/acrobat/readstep2.html" internalinstanceid="15">
                    </div>
                    <div class="col-xs-0 col-sm-5 col-md-4 lecture-container no-padding">
                        <ul class="nav nav-tabs lecture-container-header">
                            <li class="active">
                                <a data-toggle="1" href="javascript:void(0)">
                                    <i class="fa fa-list"></i>
                                    <span>Giáo trình</span>
                                </a>
                            </li>
                            <li>
                                <a data-toggle="2" href="javascript:void(0)">
                                    <i class="fa fa-download"></i>
                                    <span>Tài liệu</span>
                                </a>
                            </li>
                            <li>
                                <a data-toggle="3" href="javascript:void(0)">
                                    <i class="fa fa-comments"></i>
                                    <span>Thảo luận</span>
                                </a>
                            </li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane fade active in" id="lecture-tab-list">
                                <div class="list-lecture-container">
                                    {% set assetCounter = 0 %}
                                    {% set optionCounter = 0 %}
                                    {% for courseOption in courseOptions %}
                                        {% set optionCounter = optionCounter+1 %}
                                        <div class="row chap-title">{{ courseOption.title }}</div>
                                        {% for assetLink in courseOption.assets %}
                                            {% set assetCounter = assetCounter+1 %}
                                            {% set learned = "" %}
                                            {% for learnedAsset in learnedAssets %}
                                                {% if (learnedAsset.id == assetLink.id) %}
                                                    {% set learned = "learned" %}
                                                {% endif %}
                                            {% endfor %}
                                            <div class="row chap-item {{ learned }} {% if (asset.id == assetLink.id) %}current{% endif %}">
                                                <a class="fa" href="{{ path('course_asset', { 'id': course.id, 'asset_id': assetLink.id }) }}">
                                                    <div class="row item-container fa">
                                                        <div class="chap-item-status">
                                                            <div class="status-container">
                                                                <i class="fas fa-2x fa-play-circle fa-pull-left"></i>
                                                            </div>
                                                        </div>
                                                        <div class="chap-item-content">{{ assetLink.title }}</div>
                                                    </div>
                                                </a>
                                            </div>
                                        {% endfor %}
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="tab-pane fade in" id="lecture-tab-download">
                                <div class="list-lecture-container">
                                    {% set assetCounter = 0 %}
                                    {% set optionCounter = 0 %}
                                    {% for courseOption in courseOptions %}
                                        {% set optionCounter = optionCounter+1 %}
                                        <div class="row chap-title">{{ courseOption.title }}</div>
                                        {% for assetLink in courseOption.assets %}

                                            {% if assetLink.document %}
                                                {% set assetCounter = assetCounter+1 %}

                                                <div class="row chap-item  {% if (asset.id == assetLink.id) %}current{% endif %}">
                                                    <a class="fa" href="{{ asset('wp-content/uploads/courses/assets/' ~ assetLink.document) }}">
                                                        <div class="row item-container">
                                                            <div class="chap-item-status">
                                                                <div class="status-container">
                                                                    <i class="fas fa-2x fa-file fa-pull-left"></i>
                                                                </div>
                                                            </div>
                                                            <div class="chap-item-content">{{ assetLink.title }}</div>
                                                        </div>
                                                    </a>
                                                </div>
                                            {% endif %}
                                        {% endfor %}
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="tab-pane fade in" id="lecture-tab-discussion">
                                <div class="fb-comments" data-href="http://digitalskill.azurewebsites.net/" data-width="375" data-numposts="5"></div>
                            </div>
                        </div>
                    </div>
                    <div class="actions-toolbar">
                        <a class="button button-primary" href="{{ path('course_index') }}">Quay lại</a>
                    </div>
                </div>
                <!-- end course item -->
            </div>
        </div>
    </section>
{% endblock %}